# https

不使用ssl/tsl的http通信，所有信息明文传播，有三个风险
1 窃听风险(eavesdropping): 第三方可以获取通信内容
2 篡改风险(tampering): 第三方可以修改通信内容
3 冒充风险(pretending): 第三方可以冒充他人身份参与通信


通过ssl/tsl协议可以做到
1. 所有信息都是**加密传播**， 第三方无法窃听
2. 具有**校验机制**，一旦被篡改，通信双方会立刻发现
3. 配备**身份证书**，防止身份被冒充


http通信时中间人可以拦截发送方的信息，并做一些修改，然后把信息发送给接收方，这也叫中间人攻击

所以需要对传输内容进行加密，通信双方协商一个对称加密方法，一方将密钥发送给另一方，双方用此密钥加密内容后通信。

但是如果通信一开始就被中间人截获，知道了密钥，并生成一个新的密钥替换原有的密钥。如此便可以了解及篡改后续通信内容了。

为解决问题可以通过非对称加密方法将对称加密的密钥进行加密，用于保护对称加密的密钥

客户端请求通信。服务端将公钥返回给客户端，客户端使用公钥加密对称密钥，发送给服务端，中间人如果拦截到此次通信，由于不知道服务端私钥，无法知道对称密钥。

如果一开始中间人就拦截了服务端的公钥，然后将自己的公钥发送给客户端。客户端用假公钥加密对称密钥，
中间人用自己的私钥解密出对称密钥，再用服务端的公钥加密对称密钥后发送给服务端。这样一样后续通信双方使用对称加密，中间人也可以轻松解密通信内容。


纵观各种问题，问题症结在于第一次的通信是否安全。为解决问题需要引入证书。

1. 服务端将自己的公钥发给证书颁发机构，申请证书
2. 证书颁发机构用自己的私钥加密服务端的公钥，并且通过服务端网址等信息生成一个证书签名，证书签名同样经过机构的私钥加密。证书颁发机构将证书发送给服务端
3. 当客户端请通信时，服务端将证书给客户端
4. 客户端收到证书后，需要先验证证书的真伪。各大浏览器和操作系统已经维护了所有权威证书机构的名称和公钥。客户端可以从本地找到对应的机构公钥，解密出证书签名。
5. 客户端按照同样的签名规则生成证书签名，进行验证，如果解密出来的签名和自己生成的签名一致，证明证书有效。
6. 验证有效后，客户端再利用机构公钥解密出服务端的公钥。


这种情况下中间人可以拦截服务端的证书，并用自己的证书发给客户端。但是这个时候客户端会验证不通过，证书无效。

[程序员小灰:什么是 HTTPS 协议？](https://mp.weixin.qq.com/s/1ojSrhc9LZV8zlX6YblMtA)

