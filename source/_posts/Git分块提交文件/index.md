---
title: "Git分块提交文件"
author: 柚子816
toc: true
comment: true
date: 2016-07-15 22:31:00
tags: 
  - git
keywords:
  - commit
  - 提交
  - 区块
  - 部分
category: 工具
cover: ./5dc30a51-6e34-4a16-9267-ab276cb76e47.jpeg
---

一直好奇，sourcetree是怎么做到将一个文件里的多块修改分区块部分添加提交。甚至按行级别进行提交，今天终于知道怎么实现的了

其实就是用 git add 命令，只不过要加上 -p 这个参数

![](./bb9beebd-35f9-3bce-83b1-30d300dd7b16.png)  
先看这个文件的变化，修改，删除一行（换为空行），新增加一行。

下面就介绍如何只提交最后一个区块（hunk）

sourcetree中很简单，只需要点击一下stage hunk就好了，那git add -p是怎么实现的呢

![](./a1870b6f-9bd6-3a69-8081-bed9024c9b57.png)  

可以看到现在显示的是第一个区块，最后一行是需要我们来做决定，需要输入命令来操作这个区块，暂时选择 j, 什么意思等到下个区块再看


![](./0ca217e4-5669-3195-a741-b49ec6f3b5a3.png)  

现在下面蓝色的选项比之前多了k, K，至于这里面每项表示什么意思，git官网的文档上有，这里只要直接回车（默认就是？表示help嘛）


![](./c0801268-54c6-3a31-bd7d-d6ec62cb3107.png)  

这里面对每一项做了解释，这样就不需要记住第个选项的意思了，需要就看一下就好了。

比如选择g的时候，会出现下面这样的选择


![](./4c2482a2-2f80-3e6e-a017-54601da430d1.png)  
三处修改选择一个前往，我们要提交第三个区块，所以选择3

在出现第三个区块先项时，选择y,表示暂存此区块


![](./b67e2763-a0e3-3071-a56d-250055b284df.png)  
在看此时的文件状态，第三个区块已经被暂存

下面看如何按行提交，比如提交剩下的两个区块每二个区块中的删除行，而不要新增加行

仍然是 git add -p命令

在出现这个区块是，选择e


![](./e2bfd15e-2977-3824-a81f-fbada6033eed.png)  

接下来就会进入编辑环境，需要知道点vim的知识


![](./75ddaa22-c972-310c-881d-ab9b36256f07.png)  

进行编辑，请关注红框的位置


![](./b5bd884a-c0c9-3a2f-956e-4585e2121186.png)  
请对比修改前后的区别

最后通过 :wq 保存并退出编辑


![](./4f19b577-ae9c-3030-8635-4c1befceb575.png)  

可以看到删除已经暂存，但是添加行还在，没有被暂存。

再看看已经暂存的修改


![](./46fa3753-c954-3d4a-84d8-38fa9dbc9ad0.png)  
第三区块， 第二区块的一行，两处都在这了。

如果想取消这些暂时或者部分区块，或者按行级别，其实和刚才的操作类似，只是用的是git reset命令

通过git status 查看文件状态，可以看到提示


![](./3cde53cc-8c2b-39c3-a36a-aba632d09b95.png)  

通过git reset HEAD 这个命令就可以了，如果分区块或者按行级别请加 -p 参数。其它的和暂存的时候是一样的，这里就不做演示了

